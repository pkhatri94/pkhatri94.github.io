<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOAAR Figure</title>
<link href="https://fonts.googleapis.com/css2?family=Overpass:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Overpass+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: #e8e8e8;
  font-family: 'Overpass', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 40px 20px;
}

.figure {
  background: #ffffff;
  width: 940px;
  padding: 30px 34px 28px;
}

.fig-label {
  font-size: 11px;
  font-weight: 700;
  color: #222;
  margin-bottom: 2px;
}
.fig-caption {
  font-size: 10px;
  color: #555;
  line-height: 1.55;
  font-weight: 300;
  margin-bottom: 24px;
  max-width: 820px;
}

.panel-letter {
  width: 17px;
  height: 17px;
  border-radius: 50%;
  background: #3a3a3a;
  color: #fff;
  font-size: 8px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.section-head {
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: #999;
  text-align: center;
  margin-bottom: 8px;
}

.box {
  border-radius: 6px;
  border: 1px solid #ddd;
  padding: 10px 11px;
  background: #fafafa;
  position: relative;
}
.box-head {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 5px;
}
.box-title {
  font-size: 10.5px;
  font-weight: 700;
  color: #222;
  line-height: 1.3;
}
.box-body {
  font-size: 9.5px;
  color: #555;
  line-height: 1.55;
  font-weight: 300;
}

.arr-h {
  display: flex;
  align-items: center;
  width: 26px;
  flex-shrink: 0;
}
.arr-h-line { flex:1; height:1px; background:#bbb; }
.arr-h-tip {
  width:0; height:0;
  border-top: 3.5px solid transparent;
  border-bottom: 3.5px solid transparent;
  border-left: 5px solid #bbb;
}
.arr-v {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.arr-v-line { width:1px; flex:1; background:#bbb; }
.arr-v-tip {
  width:0; height:0;
  border-left: 3.5px solid transparent;
  border-right: 3.5px solid transparent;
  border-top: 5px solid #bbb;
}

.row { display:flex; align-items:center; gap:0; }
.col-center { display:flex; flex-direction:column; align-items:center; }

/* Color themes */
.box.teal   { border-color: #b0ddd8; background: #e0f2ef; }
.box.teal   .panel-letter { background: #2a8a7a; }
.box.orange { border-color: #f0c090; background: #fdf0e6; }
.box.orange .panel-letter { background: #c05a10; }
.box.blue   { border-color: #a0bce0; background: #e6eef8; }
.box.blue   .panel-letter { background: #2a5a9a; }
.box.purple { border-color: #c0a0d8; background: #f0ebf8; }
.box.purple .panel-letter { background: #6a3a9a; }
.box.green  { border-color: #a0cc9a; background: #e8f5e8; }
.box.green  .panel-letter { background: #3a7a3a; }

.vis-label {
  font-size: 8px;
  color: #999;
  text-align: center;
  margin-top: 3px;
  font-weight: 300;
}

/* Input chip: stacked label + dim */
.input-chip {
  background: #f8f8f6;
  border: 1px solid #c8c8c4;
  border-radius: 3px;
  padding: 6px 9px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.input-chip-sym {
  font-family: 'Overpass Mono', monospace;
  font-size: 13px;
  font-weight: 500;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}
.input-chip-name {
  font-size: 10.5px;
  font-weight: 600;
  color: #1a1a1a;
  display: block;
  line-height: 1.2;
}
.input-chip-dim {
  font-family: 'Overpass Mono', monospace;
  font-size: 9px;
  color: #888;
  display: block;
  line-height: 1.2;
}

.loop-box {
  border: 1.5px dashed #bbb;
  border-radius: 8px;
  padding: 16px 14px 14px;
  background: #fefefe;
  position: relative;
}
.loop-badge {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  border: 1px solid #bbb;
  border-radius: 10px;
  padding: 2px 12px;
  font-size: 8.5px;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #777;
  white-space: nowrap;
}

.or-div {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0 6px;
  flex-shrink: 0;
}
.or-line-v { flex:1; width:1px; background:#ddd; }
.or-label {
  font-size: 8px;
  font-weight: 700;
  color: #bbb;
  letter-spacing: 0.08em;
  padding: 3px 0;
}
</style>
</head>
<body>
<div class="figure">

  <!-- ══════════════════════════════════
       ROW 1 — Inputs + Observed I
  ══════════════════════════════════ -->
  <div class="section-head">Inputs</div>
  <div class="row" style="margin-bottom:6px; align-items:stretch">

    <!-- A: Expression matrix -->
    <div class="box teal" style="flex:1">
      <div class="box-head">
        <div class="panel-letter">A</div>
        <div class="box-title">Spatial expression matrix</div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#2a8a7a; margin-bottom:4px">n spots × p genes</div>
      <div class="box-body">Gene expression across n spatial locations (e.g., Visium spots or MERFISH cells).</div>
      <div style="display:flex; gap:8px; margin-top:8px; align-items:flex-end">
        <div>
          <svg width="88" height="88" viewBox="0 0 88 88">
            <ellipse cx="44" cy="44" rx="40" ry="38" fill="#e8f4f0" stroke="#b0d8d0" stroke-width="0.8"/>
            <circle cx="26" cy="26" r="5.5" fill="#c0e8e0" opacity="0.85"/>
            <circle cx="36" cy="22" r="5.5" fill="#7acfc0" opacity="0.85"/>
            <circle cx="46" cy="20" r="5.5" fill="#4ab8a8" opacity="0.85"/>
            <circle cx="56" cy="22" r="5.5" fill="#2a9a88" opacity="0.85"/>
            <circle cx="64" cy="28" r="5.5" fill="#7acfc0" opacity="0.75"/>
            <circle cx="20" cy="36" r="5.5" fill="#a0d8cc" opacity="0.8"/>
            <circle cx="30" cy="32" r="5.5" fill="#2a9a88" opacity="0.9"/>
            <circle cx="41" cy="30" r="5.5" fill="#1a7060" opacity="0.95"/>
            <circle cx="51" cy="30" r="5.5" fill="#2a9a88" opacity="0.9"/>
            <circle cx="61" cy="33" r="5.5" fill="#4ab8a8" opacity="0.85"/>
            <circle cx="70" cy="38" r="5.5" fill="#c0e8e0" opacity="0.7"/>
            <circle cx="18" cy="46" r="5.5" fill="#7acfc0" opacity="0.8"/>
            <circle cx="27" cy="42" r="5.5" fill="#4ab8a8" opacity="0.9"/>
            <circle cx="37" cy="40" r="5.5" fill="#1a7060" opacity="0.9"/>
            <circle cx="47" cy="40" r="5.5" fill="#0d5048" opacity="0.95"/>
            <circle cx="57" cy="40" r="5.5" fill="#1a7060" opacity="0.9"/>
            <circle cx="67" cy="43" r="5.5" fill="#4ab8a8" opacity="0.8"/>
            <circle cx="20" cy="54" r="5.5" fill="#a0d8cc" opacity="0.8"/>
            <circle cx="30" cy="51" r="5.5" fill="#2a9a88" opacity="0.85"/>
            <circle cx="40" cy="50" r="5.5" fill="#4ab8a8" opacity="0.9"/>
            <circle cx="50" cy="50" r="5.5" fill="#2a9a88" opacity="0.85"/>
            <circle cx="60" cy="52" r="5.5" fill="#7acfc0" opacity="0.8"/>
            <circle cx="68" cy="56" r="5.5" fill="#c0e8e0" opacity="0.7"/>
            <circle cx="25" cy="62" r="5.5" fill="#c0e8e0" opacity="0.75"/>
            <circle cx="35" cy="60" r="5.5" fill="#7acfc0" opacity="0.8"/>
            <circle cx="45" cy="60" r="5.5" fill="#4ab8a8" opacity="0.85"/>
            <circle cx="55" cy="62" r="5.5" fill="#7acfc0" opacity="0.8"/>
            <circle cx="64" cy="65" r="5.5" fill="#a0d8cc" opacity="0.7"/>
            <circle cx="33" cy="70" r="5.5" fill="#c0e8e0" opacity="0.7"/>
            <circle cx="44" cy="70" r="5.5" fill="#a0d8cc" opacity="0.75"/>
            <circle cx="55" cy="70" r="5.5" fill="#c0e8e0" opacity="0.65"/>
          </svg>
          <div class="vis-label">gene expression</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:2px">
          <div style="font-size:8px;color:#888">high</div>
          <div style="width:10px;height:60px;background:linear-gradient(to bottom, #0d5048, #2a9a88, #7acfc0, #c0e8e0);border-radius:2px;border:0.5px solid #ccc"></div>
          <div style="font-size:8px;color:#888">low</div>
        </div>
      </div>
    </div>

    <div class="arr-h"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

    <!-- B: Interaction list (p×2) -->
    <div class="box orange" style="flex:0.82">
      <div class="box-head">
        <div class="panel-letter">B</div>
        <div class="box-title">Ligand–receptor pair list</div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#c05a10; margin-bottom:4px">p pairs × 2 columns</div>
      <div class="box-body">Each row is a candidate interacting pair: one column for ligand, one for receptor.</div>
      <!-- Table-style schematic -->
      <svg width="100%" height="82" viewBox="0 0 110 82" style="margin-top:6px">
        <!-- header row -->
        <rect x="4" y="4" width="48" height="13" rx="1.5" fill="#e07030" opacity="0.2"/>
        <rect x="56" y="4" width="48" height="13" rx="1.5" fill="#9050a0" opacity="0.2"/>
        <text x="28" y="13.5" font-size="7.5" fill="#c05a10" text-anchor="middle" font-family="Overpass" font-weight="600">Ligand</text>
        <text x="80" y="13.5" font-size="7.5" fill="#6a3090" text-anchor="middle" font-family="Overpass" font-weight="600">Receptor</text>
        <!-- divider -->
        <line x1="4" y1="18" x2="104" y2="18" stroke="#e0c0a0" stroke-width="0.7"/>
        <line x1="54" y1="4" x2="54" y2="78" stroke="#e0c0a0" stroke-width="0.7"/>
        <!-- pair rows -->
        <text x="28" y="28" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">VEGFA</text>
        <text x="80" y="28" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">KDR</text>
        <line x1="4" y1="31" x2="104" y2="31" stroke="#eee" stroke-width="0.5"/>
        <text x="28" y="41" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">CXCL12</text>
        <text x="80" y="41" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">CXCR4</text>
        <line x1="4" y1="44" x2="104" y2="44" stroke="#eee" stroke-width="0.5"/>
        <text x="28" y="54" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">TGFB1</text>
        <text x="80" y="54" font-size="7.5" fill="#555" text-anchor="middle" font-family="Overpass Mono">TGFBR1</text>
        <line x1="4" y1="57" x2="104" y2="57" stroke="#eee" stroke-width="0.5"/>
        <text x="28" y="66" font-size="7.5" fill="#aaa" text-anchor="middle" font-family="Overpass Mono">⋮</text>
        <text x="80" y="66" font-size="7.5" fill="#aaa" text-anchor="middle" font-family="Overpass Mono">⋮</text>
        <!-- border -->
        <rect x="4" y="4" width="100" height="74" rx="2" fill="none" stroke="#e0c0a0" stroke-width="0.8"/>
      </svg>
    </div>

    <div class="arr-h"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

    <!-- C: Spatial weights -->
    <div class="box blue" style="flex:0.78">
      <div class="box-head">
        <div class="panel-letter">C</div>
        <div class="box-title">Spatial weights graph</div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#2a5a9a; margin-bottom:4px">n × n</div>
      <div class="box-body">Proximity between spots (k-NN, Delaunay, or distance-based).</div>
      <svg width="100%" height="90" viewBox="0 0 100 90" style="margin-top:6px">
        <line x1="50" y1="18" x2="28" y2="36" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="50" y1="18" x2="72" y2="36" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="28" y1="36" x2="16" y2="56" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="28" y1="36" x2="50" y2="54" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="72" y1="36" x2="50" y2="54" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="72" y1="36" x2="82" y2="56" stroke="#9ab4d8" stroke-width="1.2" opacity="0.7"/>
        <line x1="16" y1="56" x2="34" y2="72" stroke="#9ab4d8" stroke-width="1.2" opacity="0.6"/>
        <line x1="50" y1="54" x2="34" y2="72" stroke="#9ab4d8" stroke-width="1.2" opacity="0.6"/>
        <line x1="50" y1="54" x2="66" y2="72" stroke="#9ab4d8" stroke-width="1.2" opacity="0.6"/>
        <line x1="82" y1="56" x2="66" y2="72" stroke="#9ab4d8" stroke-width="1.2" opacity="0.6"/>
        <line x1="28" y1="36" x2="72" y2="36" stroke="#9ab4d8" stroke-width="0.8" opacity="0.35" stroke-dasharray="3 2"/>
        <circle cx="50" cy="18" r="6" fill="#4a80c8" stroke="#fff" stroke-width="1"/>
        <circle cx="28" cy="36" r="6" fill="#4a80c8" stroke="#fff" stroke-width="1"/>
        <circle cx="72" cy="36" r="6" fill="#4a80c8" stroke="#fff" stroke-width="1"/>
        <circle cx="16" cy="56" r="6" fill="#6a9ad8" stroke="#fff" stroke-width="1"/>
        <circle cx="50" cy="54" r="6" fill="#2a5a9a" stroke="#fff" stroke-width="1.2"/>
        <circle cx="82" cy="56" r="6" fill="#6a9ad8" stroke="#fff" stroke-width="1"/>
        <circle cx="34" cy="72" r="6" fill="#4a80c8" stroke="#fff" stroke-width="1"/>
        <circle cx="66" cy="72" r="6" fill="#4a80c8" stroke="#fff" stroke-width="1"/>
      </svg>
      <div class="vis-label">spatial neighbors</div>
    </div>

    <div class="arr-h"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

    <!-- D: Observed bivariate Moran's I -->
    <div class="box teal" style="flex:1.05; border-color:#2a9a88; background:#e0f5f0">
      <div class="box-head">
        <div class="panel-letter" style="background:#1a7060">D</div>
        <div class="box-title">Observed bivariate Moran's I</div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#1a7060; margin-bottom:4px">per interacting pair</div>
      <div class="box-body">Spatial cross-correlation between ligand x<sub>i</sub> and receptor x<sub>j</sub> across all spots.</div>
      <div style="display:flex; gap:5px; margin-top:8px; align-items:flex-start">
        <!-- Ligand tissue: high in top-left cluster -->
        <div>
          <svg width="60" height="60" viewBox="0 0 60 60">
            <ellipse cx="30" cy="30" rx="27" ry="25" fill="#f0faf8" stroke="#b0d8d0" stroke-width="0.8"/>
            <!-- high expression cluster top-left -->
            <circle cx="16" cy="18" r="4" fill="#0d5048" opacity="0.95"/>
            <circle cx="24" cy="15" r="4" fill="#1a7060" opacity="0.9"/>
            <circle cx="20" cy="25" r="4" fill="#2a9a88" opacity="0.85"/>
            <circle cx="30" cy="18" r="4" fill="#4ab8a8" opacity="0.7"/>
            <!-- mid expression center -->
            <circle cx="32" cy="27" r="4" fill="#7acfc0" opacity="0.65"/>
            <circle cx="24" cy="33" r="4" fill="#7acfc0" opacity="0.6"/>
            <!-- low expression bottom-right -->
            <circle cx="42" cy="22" r="4" fill="#a0d8cc" opacity="0.5"/>
            <circle cx="40" cy="33" r="4" fill="#c0e8e0" opacity="0.45"/>
            <circle cx="38" cy="43" r="4" fill="#c0e8e0" opacity="0.4"/>
            <circle cx="28" cy="44" r="4" fill="#a0d8cc" opacity="0.45"/>
            <circle cx="46" cy="44" r="4" fill="#c0e8e0" opacity="0.35"/>
            <circle cx="18" cy="44" r="4" fill="#c0e8e0" opacity="0.4"/>
          </svg>
          <div class="vis-label">ligand x<sub>i</sub></div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:3px;padding-top:12px">
          <div style="font-size:10px;color:#1a7060;font-family:'Overpass Mono',monospace;font-weight:600">I<sub>obs</sub></div>
          <div style="width:1px;height:12px;background:#2a9a88"></div>
          <div style="font-size:8px;color:#555;text-align:center;line-height:1.4">spatial<br>co-expr.</div>
        </div>
        <!-- Receptor tissue: high in BOTTOM-RIGHT cluster (different spatial pattern) -->
        <div>
          <svg width="60" height="60" viewBox="0 0 60 60">
            <ellipse cx="30" cy="30" rx="27" ry="25" fill="#f8f0f8" stroke="#d0b0d0" stroke-width="0.8"/>
            <!-- low expression top-left -->
            <circle cx="16" cy="18" r="4" fill="#e0c0e0" opacity="0.35"/>
            <circle cx="24" cy="15" r="4" fill="#e0c0e0" opacity="0.4"/>
            <circle cx="20" cy="25" r="4" fill="#c890c8" opacity="0.45"/>
            <circle cx="30" cy="18" r="4" fill="#c890c8" opacity="0.5"/>
            <!-- mid expression center -->
            <circle cx="32" cy="27" r="4" fill="#b870b8" opacity="0.6"/>
            <circle cx="24" cy="33" r="4" fill="#b870b8" opacity="0.65"/>
            <!-- high expression bottom-right -->
            <circle cx="42" cy="22" r="4" fill="#904090" opacity="0.7"/>
            <circle cx="40" cy="33" r="4" fill="#701870" opacity="0.85"/>
            <circle cx="38" cy="43" r="4" fill="#1a0028" opacity="0.9"/>
            <circle cx="28" cy="44" r="4" fill="#701870" opacity="0.8"/>
            <circle cx="46" cy="44" r="4" fill="#1a0028" opacity="0.95"/>
            <circle cx="18" cy="44" r="4" fill="#904090" opacity="0.65"/>
          </svg>
          <div class="vis-label">receptor x<sub>j</sub></div>
        </div>
      </div>
    </div>

  </div>

  <!-- vertical connector -->
  <div style="height:18px;display:flex;justify-content:center;align-items:center">
    <div class="col-center" style="height:18px"><div class="arr-v-line"></div><div class="arr-v-tip"></div></div>
  </div>

  <!-- ══════════════════════════════════
       ROW 2 — Spectral decomp
  ══════════════════════════════════ -->
  <div class="section-head">Spectral decomposition of spatial weights</div>

  <div class="row" style="gap:0; margin-bottom:6px; align-items:stretch">

    <!-- E: Double center + decompose -->
    <div class="box blue" style="flex:1.1">
      <div class="box-head">
        <div class="panel-letter">E</div>
        <div class="box-title">Double-center &amp; eigen-decompose <b>W</b></div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#2a5a9a; margin-bottom:4px">W<sub>c</sub> = U Λ Uᵀ</div>
      <div class="box-body">Subtract row and column means from <b>W</b> to obtain <b>W</b><sub>c</sub>. Eigendecompose to extract orthonormal spatial basis vectors.</div>
      <div style="display:flex;gap:10px;margin-top:8px;align-items:center">
        <div>
          <svg width="54" height="54" viewBox="0 0 54 54">
            <rect width="54" height="54" rx="2" fill="#e8eef8" stroke="#c0d0e8" stroke-width="0.5"/>
            <rect x="2" y="2" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.4"/>
            <rect x="13" y="2" width="10" height="10" rx="1" fill="#5a8ad0" opacity="0.8"/>
            <rect x="24" y="2" width="10" height="10" rx="1" fill="#2a5a9a" opacity="0.9"/>
            <rect x="35" y="2" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.3"/>
            <rect x="46" y="2" width="6" height="10" rx="1" fill="#8aaed8" opacity="0.6"/>
            <rect x="2" y="13" width="10" height="10" rx="1" fill="#5a8ad0" opacity="0.85"/>
            <rect x="13" y="13" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.4"/>
            <rect x="24" y="13" width="10" height="10" rx="1" fill="#8aaed8" opacity="0.65"/>
            <rect x="35" y="13" width="10" height="10" rx="1" fill="#2a5a9a" opacity="0.85"/>
            <rect x="46" y="13" width="6" height="10" rx="1" fill="#ccdaf0" opacity="0.35"/>
            <rect x="2" y="24" width="10" height="10" rx="1" fill="#2a5a9a" opacity="0.9"/>
            <rect x="13" y="24" width="10" height="10" rx="1" fill="#8aaed8" opacity="0.65"/>
            <rect x="24" y="24" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.4"/>
            <rect x="35" y="24" width="10" height="10" rx="1" fill="#5a8ad0" opacity="0.8"/>
            <rect x="46" y="24" width="6" height="10" rx="1" fill="#2a5a9a" opacity="0.85"/>
            <rect x="2" y="35" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.35"/>
            <rect x="13" y="35" width="10" height="10" rx="1" fill="#2a5a9a" opacity="0.85"/>
            <rect x="24" y="35" width="10" height="10" rx="1" fill="#5a8ad0" opacity="0.8"/>
            <rect x="35" y="35" width="10" height="10" rx="1" fill="#ccdaf0" opacity="0.4"/>
            <rect x="46" y="35" width="6" height="10" rx="1" fill="#8aaed8" opacity="0.6"/>
            <rect x="2" y="46" width="10" height="6" rx="1" fill="#8aaed8" opacity="0.55"/>
            <rect x="13" y="46" width="10" height="6" rx="1" fill="#ccdaf0" opacity="0.35"/>
            <rect x="24" y="46" width="10" height="6" rx="1" fill="#2a5a9a" opacity="0.8"/>
            <rect x="35" y="46" width="10" height="6" rx="1" fill="#8aaed8" opacity="0.55"/>
            <rect x="46" y="46" width="6" height="6" rx="1" fill="#ccdaf0" opacity="0.35"/>
          </svg>
          <div class="vis-label">spatial weights <b>W</b></div>
        </div>
        <div style="font-size:13px;color:#bbb">→</div>
        <div>
          <svg width="75" height="54" viewBox="0 0 75 54">
            <ellipse cx="12" cy="27" rx="9" ry="22" fill="#e6eef8" stroke="#b0c8e8" stroke-width="0.7"/>
            <circle cx="12" cy="10" r="3" fill="#2a5a9a" opacity="0.9"/>
            <circle cx="12" cy="18" r="3" fill="#5a8ad0" opacity="0.8"/>
            <circle cx="12" cy="26" r="3" fill="#8aaed8" opacity="0.6"/>
            <circle cx="12" cy="34" r="3" fill="#5a8ad0" opacity="0.75"/>
            <circle cx="12" cy="42" r="3" fill="#2a5a9a" opacity="0.85"/>
            <ellipse cx="37" cy="27" rx="9" ry="22" fill="#e6eef8" stroke="#b0c8e8" stroke-width="0.7"/>
            <circle cx="37" cy="10" r="3" fill="#8aaed8" opacity="0.5"/>
            <circle cx="37" cy="18" r="3" fill="#2a5a9a" opacity="0.85"/>
            <circle cx="37" cy="26" r="3" fill="#ccdaf0" opacity="0.5"/>
            <circle cx="37" cy="34" r="3" fill="#2a5a9a" opacity="0.85"/>
            <circle cx="37" cy="42" r="3" fill="#8aaed8" opacity="0.55"/>
            <ellipse cx="62" cy="27" rx="9" ry="22" fill="#e6eef8" stroke="#b0c8e8" stroke-width="0.7"/>
            <circle cx="62" cy="10" r="3" fill="#ccdaf0" opacity="0.4"/>
            <circle cx="62" cy="18" r="3" fill="#8aaed8" opacity="0.6"/>
            <circle cx="62" cy="26" r="3" fill="#2a5a9a" opacity="0.9"/>
            <circle cx="62" cy="34" r="3" fill="#8aaed8" opacity="0.55"/>
            <circle cx="62" cy="42" r="3" fill="#ccdaf0" opacity="0.4"/>
            <text x="12" y="52" font-size="6.5" fill="#888" text-anchor="middle" font-family="Overpass">u₁</text>
            <text x="37" y="52" font-size="6.5" fill="#888" text-anchor="middle" font-family="Overpass">u₂</text>
            <text x="62" y="52" font-size="6.5" fill="#888" text-anchor="middle" font-family="Overpass">u₃</text>
          </svg>
          <div class="vis-label">eigenvectors <b>U</b> (spatial modes)</div>
        </div>
      </div>
    </div>

    <div class="arr-h"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

    <!-- F: R matrix -->
    <div class="box blue" style="flex:1.1">
      <div class="box-head">
        <div class="panel-letter">F</div>
        <div class="box-title">Feature–eigenvector correlation matrix <b>R</b></div>
      </div>
      <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#2a5a9a; margin-bottom:4px">R = corr(X, U) &nbsp;|&nbsp; p genes × k eigenvectors</div>
      <div class="box-body">Pearson correlation of each gene's expression with each spatial eigenvector. Captures how strongly each gene aligns with each spatial mode.</div>
      <div style="margin-top:8px">
        <svg width="100%" height="62" viewBox="0 0 200 62">
          <text x="28" y="8" font-size="6" fill="#888" text-anchor="middle" font-family="Overpass Mono">u₁</text>
          <text x="52" y="8" font-size="6" fill="#888" text-anchor="middle" font-family="Overpass Mono">u₂</text>
          <text x="76" y="8" font-size="6" fill="#888" text-anchor="middle" font-family="Overpass Mono">u₃</text>
          <text x="100" y="8" font-size="6" fill="#888" text-anchor="middle" font-family="Overpass Mono">u₄</text>
          <text x="124" y="8" font-size="6" fill="#888" text-anchor="middle" font-family="Overpass Mono">…</text>
          <!-- gene 1 -->
          <rect x="16" y="11" width="22" height="10" rx="1" fill="#2a5a9a" opacity="0.9"/>
          <rect x="40" y="11" width="22" height="10" rx="1" fill="#8aaed8" opacity="0.5"/>
          <rect x="64" y="11" width="22" height="10" rx="1" fill="#ccdaf0" opacity="0.3"/>
          <rect x="88" y="11" width="22" height="10" rx="1" fill="#5a8ad0" opacity="0.65"/>
          <rect x="112" y="11" width="22" height="10" rx="1" fill="#ccdaf0" opacity="0.25"/>
          <text x="148" y="19" font-size="6.5" fill="#888" font-family="Overpass Mono">VEGFA</text>
          <!-- gene 2 -->
          <rect x="16" y="23" width="22" height="10" rx="1" fill="#ccdaf0" opacity="0.3"/>
          <rect x="40" y="23" width="22" height="10" rx="1" fill="#2a5a9a" opacity="0.85"/>
          <rect x="64" y="23" width="22" height="10" rx="1" fill="#5a8ad0" opacity="0.7"/>
          <rect x="88" y="23" width="22" height="10" rx="1" fill="#ccdaf0" opacity="0.3"/>
          <rect x="112" y="23" width="22" height="10" rx="1" fill="#8aaed8" opacity="0.5"/>
          <text x="148" y="31" font-size="6.5" fill="#888" font-family="Overpass Mono">KDR</text>
          <!-- gene 3 -->
          <rect x="16" y="35" width="22" height="10" rx="1" fill="#8aaed8" opacity="0.55"/>
          <rect x="40" y="35" width="22" height="10" rx="1" fill="#ccdaf0" opacity="0.35"/>
          <rect x="64" y="35" width="22" height="10" rx="1" fill="#2a5a9a" opacity="0.9"/>
          <rect x="88" y="35" width="22" height="10" rx="1" fill="#8aaed8" opacity="0.6"/>
          <rect x="112" y="35" width="22" height="10" rx="1" fill="#2a5a9a" opacity="0.8"/>
          <text x="148" y="43" font-size="6.5" fill="#888" font-family="Overpass Mono">CXCL12</text>
          <text x="28" y="53" font-size="8" fill="#bbb" text-anchor="middle">⋮</text>
          <text x="52" y="53" font-size="8" fill="#bbb" text-anchor="middle">⋮</text>
          <text x="76" y="53" font-size="8" fill="#bbb" text-anchor="middle">⋮</text>
          <text x="100" y="53" font-size="8" fill="#bbb" text-anchor="middle">⋮</text>
          <text x="124" y="53" font-size="8" fill="#bbb" text-anchor="middle">⋮</text>
        </svg>
      </div>
    </div>

  </div>

  <!-- vertical connector -->
  <div style="height:18px;display:flex;justify-content:center;align-items:center">
    <div class="col-center" style="height:18px"><div class="arr-v-line"></div><div class="arr-v-tip"></div></div>
  </div>

  <!-- ══════════════════════════════════
       ROW 3 — Permutation loop
  ══════════════════════════════════ -->
  <div class="section-head">Null model construction</div>

  <div class="loop-box" style="margin-bottom:6px">
    <div class="loop-badge">↺ &nbsp; repeat n permutations</div>

    <div class="row" style="align-items:stretch; gap:0">

      <!-- G1 / G2 methods block -->
      <div style="flex:1.7; display:flex; flex-direction:column">
        <div style="font-size:8.5px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:#777;text-align:center;margin-bottom:6px">Randomization strategy (branch)</div>
        <div style="display:flex;gap:0;flex:1">

          <!-- G1: Sign flip -->
          <div class="box purple" style="flex:1;border-radius:6px 0 0 6px;border-right:none;display:flex;flex-direction:column">
            <div class="box-head">
              <div class="panel-letter" style="font-size:7.5px">G1</div>
              <div class="box-title" style="font-size:10px">Sign flip</div>
            </div>
            <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#6a3a9a; margin-bottom:4px">r̃<sub>ij</sub> = ε<sub>ij</sub> · r<sub>ij</sub>, &nbsp;ε ~ Rad(½)</div>
            <div class="box-body">Randomly negate each correlation r<sub>ij</sub> with probability ½, independently disrupting co-expression structure.</div>
            <svg width="100%" height="50" viewBox="0 0 110 50" style="margin-top:6px">
              <rect x="2" y="6" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.8"/>
              <rect x="15" y="6" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.5"/>
              <rect x="28" y="6" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.75"/>
              <rect x="2" y="19" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.6"/>
              <rect x="15" y="19" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.85"/>
              <rect x="28" y="19" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.5"/>
              <rect x="2" y="32" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.65"/>
              <rect x="15" y="32" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.8"/>
              <rect x="28" y="32" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.7"/>
              <text x="20" y="48" font-size="6.5" fill="#aaa" text-anchor="middle" font-family="Overpass">R</text>
              <text x="47" y="26" font-size="14" fill="#bbb">→</text>
              <rect x="60" y="6" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.8"/>
              <rect x="73" y="6" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.5"/>
              <rect x="86" y="6" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.75"/>
              <rect x="60" y="19" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.6"/>
              <rect x="73" y="19" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.85"/>
              <rect x="86" y="19" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.5"/>
              <rect x="60" y="32" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.65"/>
              <rect x="73" y="32" width="12" height="12" rx="1.5" fill="#4a80c8" opacity="0.8"/>
              <rect x="86" y="32" width="12" height="12" rx="1.5" fill="#c85070" opacity="0.7"/>
              <text x="66" y="6" font-size="7" fill="white" text-anchor="middle" font-family="Overpass Mono" opacity="0.75">−</text>
              <text x="79" y="6" font-size="7" fill="white" text-anchor="middle" font-family="Overpass Mono" opacity="0.75">+</text>
              <text x="92" y="6" font-size="7" fill="white" text-anchor="middle" font-family="Overpass Mono" opacity="0.75">+</text>
              <text x="78" y="48" font-size="6.5" fill="#aaa" text-anchor="middle" font-family="Overpass">R̃</text>
            </svg>
          </div>

          <!-- OR -->
          <div class="or-div"><div class="or-line-v"></div><div class="or-label">or</div><div class="or-line-v"></div></div>

          <!-- G2: Angle rotation -->
          <div class="box purple" style="flex:1.2;border-radius:0 6px 6px 0;border-left:none;display:flex;flex-direction:column">
            <div class="box-head">
              <div class="panel-letter" style="font-size:7.5px">G2</div>
              <div class="box-title" style="font-size:10px">Eigenvector pair rotation</div>
            </div>
            <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#6a3a9a; margin-bottom:4px">θ ~ U[0, 2π], &nbsp;‖ṽ‖ = ‖v‖</div>
            <div class="box-body">Pair eigenvectors; pool each gene's correlations into a 2D vector; rotate by random angle θ, preserving vector norm.</div>
            <div style="display:flex;gap:6px;align-items:center;margin-top:6px">
              <svg width="62" height="62" viewBox="0 0 62 62" style="flex-shrink:0">
                <circle cx="31" cy="31" r="24" fill="#f4f0f8" stroke="#c0a8d8" stroke-width="0.8"/>
                <line x1="31" y1="5" x2="31" y2="57" stroke="#ddd" stroke-width="0.6"/>
                <line x1="5" y1="31" x2="57" y2="31" stroke="#ddd" stroke-width="0.6"/>
                <line x1="31" y1="31" x2="50" y2="16" stroke="#7030a0" stroke-width="2" stroke-linecap="round"/>
                <circle cx="50" cy="16" r="3" fill="#7030a0"/>
                <line x1="31" y1="31" x2="13" y2="18" stroke="#9060c0" stroke-width="1.2" stroke-dasharray="3 2" stroke-linecap="round" opacity="0.65"/>
                <circle cx="13" cy="18" r="2.2" fill="#9060c0" opacity="0.55"/>
                <line x1="31" y1="31" x2="47" y2="48" stroke="#9060c0" stroke-width="1.2" stroke-dasharray="3 2" stroke-linecap="round" opacity="0.5"/>
                <circle cx="47" cy="48" r="2.2" fill="#9060c0" opacity="0.45"/>
                <line x1="31" y1="31" x2="12" y2="42" stroke="#9060c0" stroke-width="1.2" stroke-dasharray="3 2" stroke-linecap="round" opacity="0.35"/>
                <circle cx="12" cy="42" r="2.2" fill="#9060c0" opacity="0.35"/>
                <path d="M 46 20 A 17 17 0 0 0 52 33" stroke="#7030a0" stroke-width="0.9" fill="none" stroke-dasharray="2 2"/>
                <text x="49" y="28" font-size="8" fill="#7030a0" font-family="Overpass">θ</text>
                <text x="32" y="7" font-size="7" fill="#999" font-family="Overpass">u₂</text>
                <text x="50" y="34" font-size="7" fill="#999" font-family="Overpass">u₁</text>
              </svg>
              <div style="font-size:9px;color:#555;line-height:1.7;font-family:'Overpass Mono',monospace">
                v = (r·u₁, r·u₂)<br>
                <span style="color:#7030a0">θ ~ U[0,2π]</span><br>
                ṽ = R(θ)·v
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="arr-h" style="width:22px; margin:0 2px; flex-shrink:0"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

      <!-- H: Reconstruct -->
      <div class="box purple" style="flex:0.95">
        <div class="box-head">
          <div class="panel-letter">H</div>
          <div class="box-title">Reconstruct via rank matching</div>
        </div>
        <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#6a3a9a; margin-bottom:4px">x̃ ← rank-match(U R̃ᵀ, X)</div>
        <div class="box-body">Project R̃ back through eigenvectors to resampled z-scores. Apply rank matching to restore original marginal expression distributions.</div>
        <svg width="100%" height="52" viewBox="0 0 120 52" style="margin-top:6px">
          <rect x="4" y="32" width="6" height="14" rx="1" fill="#9060c0" opacity="0.4"/>
          <rect x="11" y="24" width="6" height="22" rx="1" fill="#9060c0" opacity="0.5"/>
          <rect x="18" y="14" width="6" height="32" rx="1" fill="#9060c0" opacity="0.65"/>
          <rect x="25" y="10" width="6" height="36" rx="1" fill="#9060c0" opacity="0.75"/>
          <rect x="32" y="18" width="6" height="28" rx="1" fill="#9060c0" opacity="0.6"/>
          <rect x="39" y="28" width="6" height="18" rx="1" fill="#9060c0" opacity="0.45"/>
          <line x1="2" y1="47" x2="50" y2="47" stroke="#ccc" stroke-width="0.6"/>
          <text x="26" y="51" font-size="6.5" fill="#aaa" text-anchor="middle" font-family="Overpass">z̃ = U R̃ᵀ</text>
          <text x="62" y="28" font-size="11" fill="#bbb">→</text>
          <text x="62" y="38" font-size="6" fill="#999" text-anchor="middle" font-family="Overpass">rank</text>
          <text x="62" y="44" font-size="6" fill="#999" text-anchor="middle" font-family="Overpass">match</text>
          <rect x="75" y="32" width="6" height="14" rx="1" fill="#2a9a88" opacity="0.4"/>
          <rect x="82" y="24" width="6" height="22" rx="1" fill="#2a9a88" opacity="0.5"/>
          <rect x="89" y="14" width="6" height="32" rx="1" fill="#2a9a88" opacity="0.65"/>
          <rect x="96" y="10" width="6" height="36" rx="1" fill="#2a9a88" opacity="0.75"/>
          <rect x="103" y="18" width="6" height="28" rx="1" fill="#2a9a88" opacity="0.6"/>
          <rect x="110" y="28" width="6" height="18" rx="1" fill="#2a9a88" opacity="0.45"/>
          <line x1="73" y1="47" x2="118" y2="47" stroke="#ccc" stroke-width="0.6"/>
          <text x="96" y="51" font-size="6.5" fill="#aaa" text-anchor="middle" font-family="Overpass">x̃ (marginals preserved)</text>
        </svg>
      </div>

      <div class="arr-h" style="width:22px; margin:0 2px; flex-shrink:0"><div class="arr-h-line"></div><div class="arr-h-tip"></div></div>

      <!-- I: Compute Ĩ -->
      <div class="box teal" style="flex:0.7; border-color:#2a9a88; background:#e4f5f2">
        <div class="box-head">
          <div class="panel-letter" style="background:#1a7060">Ĩ</div>
          <div class="box-title">Compute resampled I</div>
        </div>
        <div style="font-family:'Overpass Mono',monospace; font-size:9px; color:#1a7060; margin-bottom:4px">Ĩ = x̃ᵢᵀ W x̃ⱼ / n</div>
        <div class="box-body">Bivariate Moran's I on resampled x̃<sub>i</sub>, x̃<sub>j</sub>. Append to null distribution.</div>
        <div style="margin-top:8px">
          <svg width="100%" height="40" viewBox="0 0 80 40">
            <rect x="2"  y="30" width="6" height="8"  rx="1" fill="#4ab8a8" opacity="0.35"/>
            <rect x="9"  y="22" width="6" height="16" rx="1" fill="#4ab8a8" opacity="0.45"/>
            <rect x="16" y="16" width="6" height="22" rx="1" fill="#4ab8a8" opacity="0.55"/>
            <rect x="23" y="12" width="6" height="26" rx="1" fill="#4ab8a8" opacity="0.65"/>
            <rect x="30" y="18" width="6" height="20" rx="1" fill="#4ab8a8" opacity="0.5"/>
            <rect x="37" y="26" width="6" height="12" rx="1" fill="#4ab8a8" opacity="0.4"/>
            <rect x="44" y="32" width="6" height="6"  rx="1" fill="#4ab8a8" opacity="0.3"/>
            <circle cx="56" cy="10" r="4" fill="#e07030" opacity="0.8"/>
            <line x1="56" y1="14" x2="56" y2="38" stroke="#e07030" stroke-width="1.2" stroke-dasharray="2 2" opacity="0.7"/>
            <text x="56" y="40" font-size="6.5" fill="#e07030" text-anchor="middle" font-family="Overpass">Ĩ</text>
          </svg>
        </div>
      </div>

    </div>
  </div>

  <!-- vertical connector -->
  <div style="height:18px;display:flex;justify-content:center;align-items:center">
    <div class="col-center" style="height:18px"><div class="arr-v-line"></div><div class="arr-v-tip"></div></div>
  </div>

  <!-- ══════════════════════════════════
       ROW 4 — Output
  ══════════════════════════════════ -->
  <div class="section-head">Statistical inference</div>
  <div class="row" style="gap:0; align-items:stretch">

    <!-- J: Null distribution + p-value combined -->
    <div class="box green" style="flex:1.9">
      <div class="box-head">
        <div class="panel-letter">J</div>
        <div class="box-title">Empirical null distribution &amp; p-value</div>
      </div>
      <div class="box-body">The n resampled Ĩ values form the null distribution. The empirical p-value equals the shaded area under the null curve to the right of the observed I<sub>obs</sub>.</div>
      <div style="margin-top:10px">
        <svg width="100%" height="118" viewBox="0 0 380 118">
          <defs>
            <linearGradient id="nullG" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#3a8a3a" stop-opacity="0.18"/>
              <stop offset="100%" stop-color="#3a8a3a" stop-opacity="0.03"/>
            </linearGradient>
            <linearGradient id="tailG" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#c04030" stop-opacity="0.45"/>
              <stop offset="100%" stop-color="#c04030" stop-opacity="0.08"/>
            </linearGradient>
            <clipPath id="tailClip">
              <rect x="220" y="0" width="160" height="106"/>
            </clipPath>
          </defs>

          <!-- full bell fill -->
          <path d="M 20 96 Q 60 95 95 87 Q 125 74 148 54 Q 163 36 175 27 Q 183 21 190 19 Q 197 21 205 27 Q 217 36 232 54 Q 255 74 285 87 Q 320 95 360 96 Z" fill="url(#nullG)"/>

          <!-- tail fill clipped -->
          <path d="M 20 96 Q 60 95 95 87 Q 125 74 148 54 Q 163 36 175 27 Q 183 21 190 19 Q 197 21 205 27 Q 217 36 232 54 Q 255 74 285 87 Q 320 95 360 96 Z" fill="url(#tailG)" clip-path="url(#tailClip)"/>

          <!-- bell outline -->
          <path d="M 20 96 Q 60 95 95 87 Q 125 74 148 54 Q 163 36 175 27 Q 183 21 190 19 Q 197 21 205 27 Q 217 36 232 54 Q 255 74 285 87 Q 320 95 360 96" stroke="#4a9a4a" stroke-width="1.4" fill="none"/>

          <!-- x axis -->
          <line x1="14" y1="96" x2="366" y2="96" stroke="#ccc" stroke-width="0.7"/>
          <line x1="190" y1="93" x2="190" y2="99" stroke="#bbb" stroke-width="0.7"/>
          <text x="190" y="106" font-size="8" fill="#999" text-anchor="middle" font-family="Overpass">0</text>

          <!-- I_obs vertical line -->
          <line x1="220" y1="96" x2="220" y2="36" stroke="#c04030" stroke-width="1.6" stroke-dasharray="5 3"/>
          <circle cx="220" cy="34" r="4" fill="#c04030"/>
          <text x="226" y="30" font-size="9" fill="#c04030" font-family="Overpass" font-weight="600">I<tspan font-size="7" dy="1.5">obs</tspan></text>

          <!-- p-value equation box — all content inside -->
          <rect x="248" y="30" width="118" height="56" rx="3" fill="#fff8f7" stroke="#c04030" stroke-width="1.2"/>
          <!-- "p =" on left, vertically centred -->
          <text x="262" y="61" font-size="10" fill="#c04030" font-family="Overpass Mono" font-weight="600">p =</text>
          <!-- numerator -->
          <text x="326" y="50" font-size="9" fill="#c04030" font-family="Overpass Mono" font-weight="500" text-anchor="middle">#{Ĩ ≥ I<tspan font-size="6.5" dy="1.5">obs</tspan><tspan font-size="9" dy="-1.5">}</tspan></text>
          <!-- fraction line -->
          <line x1="284" y1="57" x2="366" y2="57" stroke="#c04030" stroke-width="1"/>
          <!-- denominator -->
          <text x="326" y="70" font-size="9" fill="#c04030" font-family="Overpass Mono" font-weight="500" text-anchor="middle">n</text>

          <!-- arrow from box to tail shading -->
          <path d="M 248 72 Q 238 76 232 80" stroke="#c04030" stroke-width="0.9" fill="none" stroke-dasharray="2.5 2" opacity="0.85"/>
          <circle cx="231" cy="81" r="2" fill="#c04030" opacity="0.75"/>

          <!-- axis labels -->
          <text x="190" y="14" font-size="8" fill="#888" text-anchor="middle" font-family="Overpass">Null distribution of Ĩ (n permutations)</text>
          <text x="10" y="60" font-size="7.5" fill="#aaa" text-anchor="middle" transform="rotate(-90,10,60)" font-family="Overpass">density</text>
        </svg>
      </div>
    </div>

    <div style="width:20px; display:flex; align-items:center; flex-shrink:0">
      <div style="height:1px;width:100%;background:#ddd"></div>
    </div>

    <!-- Key properties -->
    <div style="flex:1; padding-left:8px; display:flex; flex-direction:column; justify-content:center">
      <div style="font-size:8px;font-weight:700;letter-spacing:0.12em;text-transform:uppercase;color:#999;margin-bottom:8px">Properties of null model</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;gap:6px;align-items:flex-start">
          <svg width="10" height="10" viewBox="0 0 10 10" style="flex-shrink:0;margin-top:1px"><circle cx="5" cy="5" r="4" fill="none" stroke="#3a7a9a" stroke-width="1.3"/><circle cx="5" cy="5" r="1.8" fill="#3a7a9a"/></svg>
          <div style="font-size:9.5px;color:#333;line-height:1.45;font-weight:300">Preserves <b>spatial autocorrelation</b> of individual genes</div>
        </div>
        <div style="display:flex;gap:6px;align-items:flex-start">
          <svg width="10" height="10" viewBox="0 0 10 10" style="flex-shrink:0;margin-top:1px"><circle cx="5" cy="5" r="4" fill="none" stroke="#3a7a9a" stroke-width="1.3"/><circle cx="5" cy="5" r="1.8" fill="#3a7a9a"/></svg>
          <div style="font-size:9.5px;color:#333;line-height:1.45;font-weight:300">Preserves <b>marginal expression distributions</b> via rank matching</div>
        </div>
        <div style="display:flex;gap:6px;align-items:flex-start">
          <svg width="10" height="10" viewBox="0 0 10 10" style="flex-shrink:0;margin-top:1px"><circle cx="5" cy="5" r="4" fill="none" stroke="#3a7a9a" stroke-width="1.3"/><circle cx="5" cy="5" r="1.8" fill="#3a7a9a"/></svg>
          <div style="font-size:9.5px;color:#333;line-height:1.45;font-weight:300">Disrupts <b>spatial co-expression</b> between pairs while retaining individual structure</div>
        </div>
        <div style="display:flex;gap:6px;align-items:flex-start">
          <svg width="10" height="10" viewBox="0 0 10 10" style="flex-shrink:0;margin-top:1px"><circle cx="5" cy="5" r="4" fill="none" stroke="#3a7a9a" stroke-width="1.3"/><circle cx="5" cy="5" r="1.8" fill="#3a7a9a"/></svg>
          <div style="font-size:9.5px;color:#333;line-height:1.45;font-weight:300">Compatible with array-based <b>(Visium)</b> and imaging-based <b>(MERFISH)</b> platforms</div>
        </div>
      </div>
    </div>

  </div>

</div>
</body>
</html>
